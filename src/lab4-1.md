# 实验原理

## 进程

进程是正在运行并且使用计算机资源的程序。其作为资源分配的单位，在该系统中抽象出进程来维护页面映射来、存储用户态标识、表示访存空间，以及文件描述符等。

## 线程

根据以上的叙述完成的操作系统默认进程是只具有单个线程控制能力的一个执行程序，但几乎所有的现在操作系统都允许一个进程包括多个线程。例如一个浏览器可能有一个线程用来显示文本和图像，另线程从网络上接收数据等。线程是使用CPU的一个基本单元，包括线程ID、运行栈、线程执行上下文、所属进程的记号和内核栈等，他在于同一进程的相其他线程共享资源。

### 创建线程

当创建一个线程并将其执行时，需要准备建立一个线程的抽象。在此抽象中实现页表映射、设置起始执行地址、各种寄存器和一些执行参数。

### 切换线程

线程在切换之前，系统首先会引发中断。中断会保存上一个线程的Context，然后。将下一个线程的Context恢复进入。这需要对中断的处理函数进行一些修改以使其满足以上功能。同时线程有可能由用户线程切换到内核线程。这种跨特权级的切换会导致Context无法保存，同时还应在维护一个内核栈来保存必要的寄存器。

### 结束线程

当线程执行到函数末尾会引发缺页中断，本文的解决方式是使线程将自己标记为已结束，同时触发一个普通的断点，这时操作系统会观察到线程标记，并将其终止。

### 实现线程调度

实现一个使用高响应比优先调度算法的调度器。使用这种算法，既考虑到了执行时间，也考虑到了其他作业的等待时间。这种算法是结合了先来先服务和最短作业优先两种算法优点的折中算法。